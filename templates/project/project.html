{% extends "base.html" %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'css/project/graph.css' %}">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

<div class="pc-container">
    <div class="pc-content">
        <div class="container">
            <div class="card p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="text-dark mb-0">Project List</h2>
                    <div>
                        <a href="{% url 'create_project' %}">
                            <button class="btn btn-primary"> + Create Project</button>
                        </a>
                    </div>
                </div>

                <div class="container mt-4 ">
                    <div class="row g-3 mb-3">
                        <div class="col-md-3">
                            <label class="form-label">Project ID:</label>
                            <input type="text" class="form-control" placeholder="Enter Project ID">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Search By Queue:</label>
                            <input type="text" class="form-control" placeholder="Enter Queue Name">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Department:</label>
                            <select class="form-select">
                                <option value="">All Departments</option>
                                <option>Finance</option>
                                <option>IT</option>
                                <option>HR</option>
                                <option>Cybersecurity</option>
                                <option>Software Development</option>
                                <option>Transport</option>
                                <option>Public Services</option>
                                <option>Government</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Project Status:</label>
                            <select class="form-select">
                                <option value="">All</option>
                                <option>To-Do</option>
                                <option>In Progress</option>
                                <option>Completed</option>
                            </select>
                        </div>
                    </div>
                    <div class="row g-3 align-items-end">
                        <div class="col-md-5">
                            <label class="form-label fw-bold">Date Range:</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="dateRange"
                                       placeholder="Select Date Range" readonly="readonly">
                                <span class="input-group-text" id="dateRangeIcon"><i class="bi bi-calendar"></i></span>
                            </div>
                            <div id="dateError" class="text-danger"></div>
                        </div>
                        <div class="col-md-7 d-flex justify-content-end gap-2">
                            <button class="btn btn-primary">Apply</button>
                            <button class="btn btn-secondary">Reset</button>
                        </div>
                    </div>

                    <!-- Task Summary Cards -->
                    <div class="row mt-4">
                        <div class="col-md-3">
                            <div class="card bg-light-primary text-white p-3">
                                <h6 class="text-dark">Total Tasks</h6>
                                <h4>46
                                </h4>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-light-success text-white p-3">
                                <h6 class="text-light-dark">Completed Task</h6>
                                <h4>78
                                </h4>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-light-danger text-dark p-3">
                                <h6 class="text-light-dark">Pending Task</h6>
                                <h4>35
                                </h4>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-light-warning text-dark p-3">
                                <h6 class="text-dark">Running Task</h6>
                                <h4>46
                                </h4>
                            </div>
                        </div>
                    </div>

                    <!-- Graph Section (Placed Above Table) -->
                    <div class="container mt-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="text-muted">Graph History</h6>
                            <button class="btn btn-dark" id="toggleGraph">
                                <span id="toggleIcon">+</span>
                            </button>
                        </div>

                        <!-- Collapsible Graph Section -->
                        <div id="graphHistory" class="collapse mt-3">
                            <div class="p-3 border rounded bg-light">
                                <div class="row">
                                    <div class="col-md-4">
                                        <h6 class="text-center">Bar Chart</h6>
                                        <canvas id="barChart"></canvas>
                                    </div>
                                    <div class="col-md-4">
                                        <h6 class="text-center">Line Chart</h6>
                                        <canvas id="lineChart"></canvas>
                                    </div>
                                    <div class="col-md-4">
                                        <h6 class="text-center">Pie Chart</h6>
                                        <canvas id="pieChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Entries Limit Dropdown + Table -->
                    <div class="d-flex justify-content-between align-items-center mt-4">
                        <div class="d-flex align-items-center">
                            <label for="entriesLimit" class="me-2">Show</label>
                            <select id="entriesLimit" class="form-select form-select-sm" style="width: auto;">
                                <option value="5">5</option>
                                <option value="10" selected>10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                            </select>
                            <label for="entriesLimit" class="ms-2">entries</label>
                        </div>
                    </div>

                    <!-- Table Section -->
                    <div class="table-responsive">
                        <table id="taskTable" class="table table-bordered table-hover mt-3">
                            <thead style="background-color: white">
                            <tr>
                                <th>Project ID <img src="{% static  'Png/sort.png' %}" style="width: 16px;"></th>
                                <th>Project Name <img src="{% static  'Png/sort.png' %}" style="width: 16px;"></th>
                                <th>Department <img src="{%  static 'Png/sort.png' %}" style="width: 16px;"></th>
                                <th>Project Queue <img src="{% static 'Png/sort.png' %}" style="width: 16px;"></th>
                                <th>Progress <img src="{% static 'Png/sort.png' %}" style="width: 16px;"></th>
                                <th>Status <img src="{% static 'Png/sort.png' %}" style="width: 16px;"></th>
                                <th>Updated By <img src="{% static 'Png/sort.png' %}" style="width: 16px;"></th>
                                <th>Manage</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>201</td>
                                <td>Smart Tax Filing</td>
                                <td>Finance</td>
                                <td>Queue A</td>
                                <td>
                                    <div class="progress" style="height: 20px; position: relative;">
                                        <div class="progress-bar bg-warning" style="width: 50%;"></div>
                                        <span class="position-absolute w-100 text-center"
                                              style="color: black; font-weight: bold;">50%</span>
                                    </div>
                                </td>
                                <td style="width: 10px;">
                                    <button id="statusButton201" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                                            data-bs-target="#statusModal201">
                                        Status
                                    </button>

                                    <div class="modal fade" id="statusModal201" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Project Status</h5>
                                                    <button type="button" class="btn-close"
                                                            data-bs-dismiss="modal"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <p><strong>Project ID:</strong> 201</p>
                                                    <p><strong>Project Name:</strong> Smart Tax Filing</p>
                                                    <p><strong>Assigned Manager:</strong> Anita</p>

                                                    <label for="statusSelect201">Current Status:</label>
                                                    <select class="form-select" id="statusSelect201">
                                                        <option value="To-Do">To-Do</option>
                                                        <option value="In-Progress">In-Progress</option>
                                                        <option value="Pending">Pending</option>
                                                        <option value="Hold">Hold</option>
                                                        <option value="Complete">Complete</option>
                                                    </select>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Close
                                                    </button>
                                                    <button type="button" class="btn btn-primary updateStatus"
                                                            data-module-id="201">Update
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>Anita Verma</td>
                                <td>
                                    <a href="{% url 'show_project' %}" class="btn btn-info btn-sm">View</a>
                                    <a href="{% url 'modify_project' %}" class="btn btn-warning btn-sm">Modify</a>
                                    <button class="btn btn-danger btn-sm" data-bs-toggle="modal"
                                            data-bs-target="#deleteConfirmationModal"
                                            data-project-id="101">Delete
                                    </button>

                                    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1"
                                         aria-labelledby="deleteModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="deleteModalLabel">Confirm
                                                        Deletion</h5>
                                                    <button type="button" class="btn-close"
                                                            data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    Are you sure you want to delete this Project?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Cancel
                                                    </button>
                                                    <button type="button" class="btn btn-danger"
                                                            id="confirmDelete">Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>

                            <tr>
                                <td>202</td>
                                <td>Cyber Security Audit</td>
                                <td>Cyber Security</td>
                                <td>Queue B</td>
                                <td>
                                    <div class="progress" style="height: 20px; position: relative;">
                                        <div class="progress-bar" style="width: 100%; background-color: green;"></div>
                                        <span class="position-absolute w-100 text-center"
                                              style="color: black; font-weight: bold;">100%</span>
                                    </div>
                                </td>
                                <td style="width: 10px;">
                                    <button id="statusButton202" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                                            data-bs-target="#statusModal202">
                                        Status
                                    </button>

                                    <div class="modal fade" id="statusModal202" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Project Status</h5>
                                                    <button type="button" class="btn-close"
                                                            data-bs-dismiss="modal"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <p><strong>Project ID:</strong> 202</p>
                                                    <p><strong>Project Name:</strong> Cyber Security Audit</p>
                                                    <p><strong>Assigned Manager:</strong> Amit</p>

                                                    <label for="statusSelect202">Current Status:</label>
                                                    <select class="form-select" id="statusSelect202">
                                                        <option value="To-Do">To-Do</option>
                                                        <option value="In-Progress">In-Progress</option>
                                                        <option value="Pending">Pending</option>
                                                        <option value="Hold">Hold</option>
                                                        <option value="Complete">Complete</option>
                                                    </select>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Close
                                                    </button>
                                                    <button type="button" class="btn btn-primary updateStatus"
                                                            data-module-id="202">Update
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>Amit Verma</td>
                                <td>
                                    <a href="{% url 'show_project' %}" class="btn btn-info btn-sm">View</a>
                                    <a href="{% url 'modify_project' %}" class="btn btn-warning btn-sm">Modify</a>
                                    <button class="btn btn-danger btn-sm" data-bs-toggle="modal"
                                            data-bs-target="#deleteConfirmationModal"
                                            data-project-id="101">Delete
                                    </button>

                                    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1"
                                         aria-labelledby="deleteModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="deleteModalLabel">Confirm
                                                        Deletion</h5>
                                                    <button type="button" class="btn-close"
                                                            data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    Are you sure you want to delete this Project?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Cancel
                                                    </button>
                                                    <button type="button" class="btn btn-danger"
                                                            id="confirmDelete">Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>203</td>
                                <td>Railway Ticket Booking System</td>
                                <td>Software Development</td>
                                <td>Queue C</td>
                                <td>
                                    <div class="progress" style="height: 20px; position: relative;">
                                        <div class="progress-bar" style="width: 20%; background-color: red;"></div>
                                        <span class="position-absolute w-100 text-center"
                                              style="color: black; font-weight: bold;">20%</span>
                                    </div>
                                </td>
                                <td style="width: 10px;">

                                    <button id="statusButton203" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                                            data-bs-target="#statusModal203">
                                        Status
                                    </button>

                                    <div class="modal fade" id="statusModal203" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Project Status</h5>
                                                    <button type="button" class="btn-close"
                                                            data-bs-dismiss="modal"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <p><strong>Project ID:</strong> 203</p>
                                                    <p><strong>Project Name:</strong> Railway Ticket Booking System</p>
                                                    <p><strong>Assigned Manager:</strong> Neha</p>

                                                    <label for="statusSelect203">Current Status:</label>
                                                    <select class="form-select" id="statusSelect203">
                                                        <option value="To-Do">To-Do</option>
                                                        <option value="In-Progress">In-Progress</option>
                                                        <option value="Pending">Pending</option>
                                                        <option value="Hold">Hold</option>
                                                        <option value="Complete">Complete</option>
                                                    </select>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Close
                                                    </button>
                                                    <button type="button" class="btn btn-primary updateStatus"
                                                            data-module-id="203">Update
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>Neha Pandey</td>
                                <td>
                                    <a href="{% url 'show_project' %}" class="btn btn-info btn-sm">View</a>
                                    <a href="{% url 'modify_project' %}" class="btn btn-warning btn-sm">Modify</a>
                                    <button class="btn btn-danger btn-sm" data-bs-toggle="modal"
                                            data-bs-target="#deleteConfirmationModal"
                                            data-project-id="101">Delete
                                    </button>

                                    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1"
                                         aria-labelledby="deleteModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="deleteModalLabel">Confirm
                                                        Deletion</h5>
                                                    <button type="button" class="btn-close"
                                                            data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    Are you sure you want to delete this Project?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Cancel
                                                    </button>
                                                    <button type="button" class="btn btn-danger"
                                                            id="confirmDelete">Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <nav>
                        <ul class="pagination justify-content-center flex-wrap">
                            <li class="page-item"><a class="page-link" href="#">Prev</a></li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item"><a class="page-link" href="#">Next</a></li>
                        </ul>
                    </nav>

                    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                    <script type="text/javascript"
                            src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
                    <script type="text/javascript"
                            src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

                    <script src="{% static 'Javascript/project/graphProject.js' %}"></script>
                    <script src="{% static 'Javascript/project/statusProject.js'%}"></script>

                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            const dateRangeInput = document.getElementById('dateRange');
                            const dateRangeIcon = document.getElementById('dateRangeIcon');

                            // Initialize daterangepicker
                            $(dateRangeInput).daterangepicker({
                                opens: 'left',
                                autoUpdateInput: false,
                                locale: {
                                    cancelLabel: 'Clear'
                                }
                            });

                            $(dateRangeInput).on('apply.daterangepicker', function(ev, picker) {
                                dateRangeInput.value = picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY');
                            });

                            $(dateRangeInput).on('cancel.daterangepicker', function(ev, picker) {
                                dateRangeInput.value = '';
                            });

                            // Icon click
                            dateRangeIcon.addEventListener('click', function(event) {
                                event.preventDefault();
                                dateRangeInput.focus(); // Try to focus
                                $(dateRangeInput).trigger('click'); // Use jQuery to trigger the click
                            });

                            document.addEventListener("DOMContentLoaded", function () {
                                const fileInput = document.getElementById("projectFile");
                                const fileNameDisplay = document.getElementById("fileName");
                                const uploadBtn = document.getElementById("uploadBtn");

                                fileInput.addEventListener("change", function () {
                                    let file = this.files[0];
                                    if (file) {
                                        fileNameDisplay.textContent = file.name; // Show file name
                                        uploadBtn.disabled = false; // Enable upload button
                                    } else {
                                        fileNameDisplay.textContent = "No file chosen";
                                        uploadBtn.disabled = true;
                                    }
                                });

                                uploadBtn.addEventListener("click", function () {
                                    alert("✅ File Uploaded Successfully!");
                                });
                            });
                        });
                    </script>
{% endblock %}